<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Analytics Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header p {
            color: var(--secondary);
            font-size: 1.1em;
        }
        
        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        select, button {
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        select:focus, button:hover {
            border-color: var(--primary);
            outline: none;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            font-weight: 600;
        }
        
        button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }
        
        button.secondary {
            background: var(--secondary);
        }
        
        button.success {
            background: var(--success);
        }
        
        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .match-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .match-card:hover {
            transform: translateY(-5px);
        }
        
        .match-card.live {
            border-left: 5px solid var(--success);
        }
        
        .match-card.value-bet {
            border-left: 5px solid var(--warning);
        }
        
        .teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .team {
            text-align: center;
            flex: 1;
        }
        
        .team-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .team-odds {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .vs {
            margin: 0 15px;
            color: var(--secondary);
            font-weight: 600;
        }
        
        .prediction {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .prediction-bar {
            display: flex;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .home-prob { background: #3b82f6; }
        .draw-prob { background: #94a3b8; }
        .away-prob { background: #ef4444; }
        
        .probability-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .value-bet-indicator {
            background: var(--warning);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }
        
        .live-indicator {
            background: var(--success);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }
        
        .custom-prediction {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--secondary);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚽ Sports Analytics Platform</h1>
            <p>AI-Powered Match Predictions & Value Bet Detection</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <select id="sportSelect">
                    <option value="soccer">Soccer</option>
                    <option value="basketball">Basketball</option>
                    <option value="all">All Sports</option>
                </select>
                
                <label>
                    <input type="checkbox" id="liveMatches"> Show Live Matches
                </label>
                
                <button onclick="updateMatches()" class="secondary">🔄 Update Matches</button>
                <button onclick="updateLiveScores()" class="success">📊 Update Live Scores</button>
                <button onclick="showCustomPrediction()">🎯 Custom Prediction</button>
            </div>
        </div>
        
        <div id="matchesContainer" class="matches-grid">
            <div class="loading">Loading matches...</div>
        </div>
        
        <div id="customPredictionSection" class="custom-prediction hidden">
            <h2 style="margin-bottom: 20px;">Custom Match Prediction</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Home Team</label>
                    <input type="text" id="homeTeam" placeholder="e.g., Arsenal">
                </div>
                <div class="form-group">
                    <label>Away Team</label>
                    <input type="text" id="awayTeam" placeholder="e.g., Chelsea">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Home Odds</label>
                    <input type="number" id="homeOdds" step="0.01" placeholder="2.50" value="2.50">
                </div>
                <div class="form-group">
                    <label>Away Odds</label>
                    <input type="number" id="awayOdds" step="0.01" placeholder="2.80" value="2.80">
                </div>
                <div class="form-group">
                    <label>Draw Odds</label>
                    <input type="number" id="drawOdds" step="0.01" placeholder="3.20" value="3.20">
                </div>
            </div>
            
            <div class="form-group">
                <label>League (Optional)</label>
                <input type="text" id="league" placeholder="e.g., Premier League">
            </div>
            
            <button onclick="predictCustomMatch()" style="width: 100%;">Get AI Prediction</button>
            <button onclick="hideCustomPrediction()" class="secondary" style="width: 100%; margin-top: 10px;">Cancel</button>
            
            <div id="customPredictionResult" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        let currentMatches = [];
        
        // Load matches on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadMatches();
            setInterval(loadMatches, 30000); // Refresh every 30 seconds
        });
        
        async function loadMatches() {
            const sport = document.getElementById('sportSelect').value;
            const liveOnly = document.getElementById('liveMatches').checked;
            
            try {
                const response = await fetch(`/api/matches?sport=${sport}&live=${liveOnly}`);
                const data = await response.json();
                
                if (data.success) {
                    currentMatches = data.matches;
                    displayMatches(data.matches);
                } else {
                    showError('Failed to load matches');
                }
            } catch (error) {
                showError('Error loading matches: ' + error.message);
            }
        }
        
        function displayMatches(matches) {
            const container = document.getElementById('matchesContainer');
            
            if (matches.length === 0) {
                container.innerHTML = '<div class="loading">No matches found. Try updating matches.</div>';
                return;
            }
            
            container.innerHTML = matches.map(match => `
                <div class="match-card ${match.is_live ? 'live' : ''} ${match.value_bet_detected ? 'value-bet' : ''}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>${match.sport_title}</h3>
                        ${match.is_live ? '<span class="live-indicator">LIVE</span>' : ''}
                    </div>
                    
                    <div class="teams">
                        <div class="team">
                            <div class="team-name">${match.home_team}</div>
                            <div class="team-odds">${match.home_odds ? match.home_odds.toFixed(2) : 'N/A'}</div>
                        </div>
                        <div class="vs">vs</div>
                        <div class="team">
                            <div class="team-name">${match.away_team}</div>
                            <div class="team-odds">${match.away_odds ? match.away_odds.toFixed(2) : 'N/A'}</div>
                        </div>
                    </div>
                    
                    ${match.draw_odds ? `<div style="text-align: center; color: var(--secondary); margin-bottom: 15px;">
                        Draw: ${match.draw_odds.toFixed(2)}
                    </div>` : ''}
                    
                    ${match.is_live ? `
                        <div style="text-align: center; font-size: 24px; font-weight: bold; margin: 15px 0;">
                            ${match.home_score} - ${match.away_score}
                        </div>
                    ` : ''}
                    
                    <div class="prediction">
                        <div style="font-weight: 600; margin-bottom: 10px;">
                            AI Prediction: 
                            <span style="color: var(--primary);">
                                ${match.predicted_winner === 'home' ? match.home_team : 
                                  match.predicted_winner === 'away' ? match.away_team : 'Draw'}
                            </span>
                            (${(match.confidence * 100).toFixed(1)}% confidence)
                        </div>
                        
                        <div class="prediction-bar">
                            <div class="home-prob" style="width: ${match.home_win_probability * 100}%"></div>
                            <div class="draw-prob" style="width: ${match.draw_probability * 100}%"></div>
                            <div class="away-prob" style="width: ${match.away_win_probability * 100}%"></div>
                        </div>
                        
                        <div class="probability-label">
                            <span>Home: ${(match.home_win_probability * 100).toFixed(1)}%</span>
                            <span>Draw: ${(match.draw_probability * 100).toFixed(1)}%</span>
                            <span>Away: ${(match.away_win_probability * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                    
                    ${match.value_bet_detected ? `
                        <div class="value-bet-indicator">
                            💎 VALUE BET: ${match.value_bet_side.toUpperCase()} 
                            (Edge: ${((match.value_bet_side === 'home' ? match.home_win_probability : 
                                     match.value_bet_side === 'away' ? match.away_win_probability : 
                                     match.draw_probability) * 100 - 
                                    (100 / (match.value_bet_side === 'home' ? match.home_odds : 
                                           match.value_bet_side === 'away' ? match.away_odds : 
                                           match.draw_odds))).toFixed(1)}%)
                        </div>
                    ` : ''}
                    
                    <div style="font-size: 12px; color: var(--secondary); margin-top: 15px;">
                        Starts: ${new Date(match.commence_time).toLocaleString()}
                    </div>
                </div>
            `).join('');
        }
        
        async function updateMatches() {
            try {
                const response = await fetch('/api/matches/update');
                const data = await response.json();
                
                if (data.success) {
                    showMessage(`Successfully updated ${data.matches_updated} matches`);
                    loadMatches();
                } else {
                    showError('Failed to update matches');
                }
            } catch (error) {
                showError('Error updating matches: ' + error.message);
            }
        }
        
        async function updateLiveScores() {
            try {
                const response = await fetch('/api/live/update');
                const data = await response.json();
                
                if (data.success) {
                    showMessage(`Updated ${data.updated_count} live matches`);
                    loadMatches();
                } else {
                    showError('Failed to update live scores');
                }
            } catch (error) {
                showError('Error updating live scores: ' + error.message);
            }
        }
        
        function showCustomPrediction() {
            document.getElementById('customPredictionSection').classList.remove('hidden');
            document.getElementById('customPredictionResult').innerHTML = '';
        }
        
        function hideCustomPrediction() {
            document.getElementById('customPredictionSection').classList.add('hidden');
        }
        
        async function predictCustomMatch() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const homeOdds = parseFloat(document.getElementById('homeOdds').value);
            const awayOdds = parseFloat(document.getElementById('awayOdds').value);
            const drawOdds = parseFloat(document.getElementById('drawOdds').value);
            const league = document.getElementById('league').value;
            
            if (!homeTeam || !awayTeam) {
                showError('Please enter both team names');
                return;
            }
            
            try {
                const response = await fetch('/api/predict/custom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        home_team: homeTeam,
                        away_team: awayTeam,
                        home_odds: homeOdds,
                        away_odds: awayOdds,
                        draw_odds: drawOdds,
                        league: league
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayCustomPredictionResult(data);
                } else {
                    showError('Prediction failed: ' + data.error);
                }
            } catch (error) {
                showError('Error getting prediction: ' + error.message);
            }
        }
        
        function displayCustomPredictionResult(data) {
            const prediction = data.prediction;
            const valueBet = data.value_bet;
            const teams = data.teams;
            
            const resultHtml = `
                <div class="prediction" style="background: #f0f9ff; border-left: 4px solid var(--primary);">
                    <h3 style="margin-bottom: 15px;">Prediction Results</h3>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 18px; font-weight: 600;">
                            ${teams.home} vs ${teams.away}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 16px;">
                            <strong>Predicted Winner:</strong> 
                            <span style="color: var(--primary);">
                                ${prediction.predicted_winner === 'home' ? teams.home : 
                                  prediction.predicted_winner === 'away' ? teams.away : 'Draw'}
                            </span>
                        </div>
                        <div style="color: var(--secondary);">
                            Confidence: ${(prediction.confidence * 100).toFixed(1)}%
                        </div>
                    </div>
                    
                    <div class="prediction-bar">
                        <div class="home-prob" style="width: ${prediction.home_win_probability * 100}%"></div>
                        <div class="draw-prob" style="width: ${prediction.draw_probability * 100}%"></div>
                        <div class="away-prob" style="width: ${prediction.away_win_probability * 100}%"></div>
                    </div>
                    
                    <div class="probability-label">
                        <span>${teams.home}: ${(prediction.home_win_probability * 100).toFixed(1)}%</span>
                        <span>Draw: ${(prediction.draw_probability * 100).toFixed(1)}%</span>
                        <span>${teams.away}: ${(prediction.away_win_probability * 100).toFixed(1)}%</span>
                    </div>
                    
                    ${valueBet ? `
                        <div class="value-bet-indicator" style="margin-top: 15px;">
                            💎 VALUE BET DETECTED: ${valueBet.side.toUpperCase()}
                            <div style="font-size: 11px; margin-top: 5px;">
                                Edge: ${(valueBet.edge * 100).toFixed(1)}% | 
                                Odds: ${valueBet.odds.toFixed(2)} | 
                                Expected Value: ${(valueBet.ev * 100).toFixed(1)}%
                            </div>
                        </div>
                    ` : `
                        <div style="text-align: center; color: var(--secondary); margin-top: 15px;">
                            No value bet detected with current threshold
                        </div>
                    `}
                </div>
            `;
            
            document.getElementById('customPredictionResult').innerHTML = resultHtml;
        }
        
        function showMessage(message) {
            alert('✅ ' + message);
        }
        
        function showError(message) {
            alert('❌ ' + message);
        }
        
        // Event listeners for real-time updates
        document.getElementById('sportSelect').addEventListener('change', loadMatches);
        document.getElementById('liveMatches').addEventListener('change', loadMatches);
    </script>
</body>
</html>
